(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8378:function(e,t,r){Promise.resolve().then(r.bind(r,4660))},4660:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return s}});var i=r(6717),n=r(7387),l=r(5893);function s(){var e,t,r,s;let{user:o,loading:d,isAuthenticated:a,login:c,logout:u}=(0,l.a)(),[h,m]=(0,n.useState)(""),[p,x]=(0,n.useState)(!1),[g,y]=(0,n.useState)(null),[j,f]=(0,n.useState)([]),[b,v]=(0,n.useState)(null),[S,w]=(0,n.useState)(null),[C,k]=(0,n.useState)(!1),[R,z]=(0,n.useState)(""),[_,B]=(0,n.useState)([]),[I,T]=(0,n.useState)(!1),[D,O]=(0,n.useState)(null),[E,P]=(0,n.useState)(!1),[A,N]=(0,n.useState)(""),[W,L]=(0,n.useState)(""),[F,M]=(0,n.useState)(""),H=null!==(e=null==o?void 0:o.id)&&void 0!==e?e:"anonymous",J=async()=>{if(null==o?void 0:o.id){T(!0);try{let e=await fetch("/api/projects?user_id=".concat(encodeURIComponent(o.id)),{headers:(0,l.g)()}),t=await e.json();B(t),!D&&t.length>0&&O(t[0].id)}catch(e){console.error("Failed to load projects:",e)}finally{T(!1)}}};(0,n.useEffect)(()=>{a&&(null==o?void 0:o.id)&&J()},[a,null==o?void 0:o.id]);let U=async e=>{e.preventDefault(),M(""),await c(A,W)?(P(!1),N(""),L("")):M("Invalid credentials")},q=async e=>{e.preventDefault(),x(!0);try{let e=await fetch("/api/ask",{method:"POST",headers:{"Content-Type":"application/json",...(0,l.g)()},body:JSON.stringify({query:h,user_id:H,project_id:null!=D?D:void 0})}),t=await e.json();y(t)}catch(e){console.error("Failed to submit:",e)}finally{x(!1)}};(0,n.useEffect)(()=>{if(!a||!(null==o?void 0:o.id)){f([]),v(null),w(null);return}(async()=>{k(!0),z("");try{let[e,t,r]=await Promise.all([fetch("/api/runs?user_id=".concat(o.id)),fetch("/api/budget?user_id=".concat(o.id)),fetch("/api/metrics/activity?user_id=".concat(o.id,"&days=7"))]);if(!e.ok||!t.ok||!r.ok)throw Error("Failed to load dashboard data");let i=await e.json(),n=await t.json(),l=await r.json();f(i),v(n),w(l)}catch(e){console.error("Failed to load dashboard data",e),z("Unable to load dashboard data.")}finally{k(!1)}})()},[a,null==o?void 0:o.id]);let K=e=>"$".concat(e.toFixed(2));return d?(0,i.jsx)("main",{style:{padding:"2rem",textAlign:"center"},children:(0,i.jsx)("p",{children:"Loading..."})}):(0,i.jsxs)("main",{style:{padding:"2rem",maxWidth:"1100px",margin:"0 auto"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"2rem"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{style:{fontSize:"2rem",marginBottom:"0.5rem"},children:"Mother-Harness"}),(0,i.jsx)("p",{style:{color:"#666",margin:0},children:"Multi-agent orchestration for research, coding, analysis, and design."})]}),(0,i.jsx)("div",{children:a?(0,i.jsxs)("div",{style:{textAlign:"right"},children:[(0,i.jsx)("p",{style:{margin:0,marginBottom:"0.5rem",fontWeight:500},children:null!==(r=null!==(t=null==o?void 0:o.name)&&void 0!==t?t:null==o?void 0:o.email)&&void 0!==r?r:null==o?void 0:o.id}),(0,i.jsx)("button",{onClick:u,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"transparent",border:"1px solid #ddd",borderRadius:"6px",cursor:"pointer"},children:"Sign Out"})]}):(0,i.jsx)("button",{onClick:()=>P(!0),style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#0070f3",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:"Sign In"})})]}),E&&(0,i.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:(0,i.jsxs)("div",{style:{backgroundColor:"white",padding:"2rem",borderRadius:"12px",width:"100%",maxWidth:"400px"},children:[(0,i.jsx)("h2",{style:{marginTop:0},children:"Sign In"}),(0,i.jsxs)("form",{onSubmit:U,children:[(0,i.jsx)("input",{type:"email",placeholder:"Email",value:A,onChange:e=>N(e.target.value),style:{width:"100%",padding:"0.75rem",marginBottom:"1rem",borderRadius:"6px",border:"1px solid #ddd",fontSize:"1rem"},required:!0}),(0,i.jsx)("input",{type:"password",placeholder:"Password",value:W,onChange:e=>L(e.target.value),style:{width:"100%",padding:"0.75rem",marginBottom:"1rem",borderRadius:"6px",border:"1px solid #ddd",fontSize:"1rem"},required:!0}),F&&(0,i.jsx)("p",{style:{color:"red",marginBottom:"1rem"},children:F}),(0,i.jsxs)("div",{style:{display:"flex",gap:"1rem"},children:[(0,i.jsx)("button",{type:"submit",style:{flex:1,padding:"0.75rem",fontSize:"1rem",backgroundColor:"#0070f3",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:"Sign In"}),(0,i.jsx)("button",{type:"button",onClick:()=>P(!1),style:{padding:"0.75rem 1.5rem",fontSize:"1rem",backgroundColor:"transparent",border:"1px solid #ddd",borderRadius:"6px",cursor:"pointer"},children:"Cancel"})]})]})]})}),a&&(0,i.jsxs)("div",{style:{padding:"0.75rem 1rem",backgroundColor:"#e6f7e6",borderRadius:"8px",marginBottom:"1.5rem",fontSize:"0.875rem"},children:["âœ“ Authenticated as ",(0,i.jsx)("strong",{children:null!==(s=null==o?void 0:o.email)&&void 0!==s?s:null==o?void 0:o.id}),(null==o?void 0:o.roles)&&o.roles.length>0&&(0,i.jsxs)("span",{style:{color:"#666"},children:[" \xb7 Roles: ",o.roles.join(", ")]})]}),(0,i.jsxs)("section",{style:{marginBottom:"2.5rem"},children:[(0,i.jsx)("h2",{style:{marginBottom:"1rem"},children:"New Run"}),(0,i.jsxs)("form",{onSubmit:q,style:{marginBottom:"1.5rem"},children:[(0,i.jsx)("textarea",{value:h,onChange:e=>m(e.target.value),placeholder:"Describe the workflow you want to run",style:{width:"100%",minHeight:"120px",padding:"1rem",fontSize:"1rem",borderRadius:"8px",border:"1px solid #ddd",marginBottom:"1rem"}}),(0,i.jsxs)("div",{style:{display:"flex",gap:"1rem",alignItems:"center",flexWrap:"wrap"},children:[(0,i.jsx)("button",{type:"submit",disabled:p||!h.trim(),style:{padding:"0.75rem 1.5rem",fontSize:"1rem",backgroundColor:"#0070f3",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",opacity:p||!h.trim()?.6:1},children:p?"Processing...":"Submit"}),(0,i.jsxs)("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[(0,i.jsx)("label",{htmlFor:"project-select",style:{fontSize:"0.875rem",color:"#555"},children:"Project"}),(0,i.jsxs)("select",{id:"project-select",value:null!=D?D:"",onChange:e=>O(e.target.value||null),style:{padding:"0.5rem",borderRadius:"6px",border:"1px solid #ddd",minWidth:"220px"},children:[(0,i.jsx)("option",{value:"",children:"Default"}),_.map(e=>(0,i.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]})]}),g&&(0,i.jsxs)("div",{style:{padding:"1rem",backgroundColor:"#f5f5f5",borderRadius:"8px"},children:[(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Task ID:"})," ",g.task_id]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Status:"})," ",g.status]})]})]}),(0,i.jsx)("section",{style:{marginBottom:"2.5rem",display:"grid",gap:"1.5rem"},children:(0,i.jsxs)("div",{style:{border:"1px solid #eee",borderRadius:"12px",padding:"1.5rem"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)("h2",{style:{margin:0},children:"Project List"}),(0,i.jsx)("button",{type:"button",onClick:J,style:{padding:"0.4rem 0.75rem",borderRadius:"6px",border:"1px solid #ddd",backgroundColor:"white",cursor:"pointer",fontSize:"0.875rem"},children:"Refresh"})]}),I?(0,i.jsx)("p",{style:{color:"#666"},children:"Loading projects..."}):(0,i.jsx)("div",{style:{marginTop:"1rem",display:"grid",gap:"0.75rem"},children:0===_.length?(0,i.jsx)("p",{style:{color:"#666"},children:"No projects yet. Submit a run to create one."}):_.map(e=>(0,i.jsxs)("div",{style:{padding:"0.75rem",borderRadius:"8px",border:e.id===D?"1px solid #0070f3":"1px solid #eee",backgroundColor:e.id===D?"#f0f6ff":"#fafafa",cursor:"pointer"},onClick:()=>O(e.id),onKeyDown:t=>{"Enter"===t.key&&O(e.id)},role:"button",tabIndex:0,children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:e.name}),(0,i.jsx)("p",{style:{margin:0,color:"#666",fontSize:"0.875rem"},children:e.type})]}),(0,i.jsxs)("div",{style:{textAlign:"right",fontSize:"0.75rem",color:"#666"},children:[(0,i.jsx)("div",{children:e.status}),(0,i.jsx)("div",{children:new Date(e.last_activity).toLocaleString()})]})]}),(0,i.jsxs)("p",{style:{margin:"0.5rem 0 0",fontSize:"0.75rem",color:"#999"},children:["Threads: ",e.threads.length]})]},e.id))})]})}),(0,i.jsxs)("section",{style:{marginTop:"3rem"},children:[(0,i.jsx)("h2",{style:{fontSize:"1.5rem",marginBottom:"1rem"},children:"Operational Dashboards"}),!a&&(0,i.jsx)("p",{style:{color:"#666"},children:"Sign in to view run history, budgets, and error trends."}),a&&R&&(0,i.jsx)("p",{style:{color:"red"},children:R}),a&&C&&(0,i.jsx)("p",{style:{color:"#666"},children:"Loading dashboard data..."}),a&&!C&&(0,i.jsxs)("div",{style:{display:"grid",gap:"1.5rem"},children:[(0,i.jsxs)("div",{style:{border:"1px solid #eee",borderRadius:"12px",padding:"1.5rem"},children:[(0,i.jsx)("h3",{style:{marginTop:0,marginBottom:"1rem"},children:"Run History"}),0===j.length?(0,i.jsx)("p",{style:{color:"#666"},children:"No runs yet."}):(0,i.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.875rem"},children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{style:{textAlign:"left",color:"#666"},children:[(0,i.jsx)("th",{style:{paddingBottom:"0.5rem"},children:"Run"}),(0,i.jsx)("th",{style:{paddingBottom:"0.5rem"},children:"Status"}),(0,i.jsx)("th",{style:{paddingBottom:"0.5rem"},children:"Created"})]})}),(0,i.jsx)("tbody",{children:j.slice(0,6).map(e=>(0,i.jsxs)("tr",{style:{borderTop:"1px solid #f0f0f0"},children:[(0,i.jsx)("td",{style:{padding:"0.5rem 0",fontWeight:500},children:e.id}),(0,i.jsx)("td",{style:{padding:"0.5rem 0",textTransform:"capitalize"},children:e.status}),(0,i.jsx)("td",{style:{padding:"0.5rem 0",color:"#666"},children:new Date(e.created_at).toLocaleString()})]},e.id))})]})]}),(0,i.jsxs)("div",{style:{border:"1px solid #eee",borderRadius:"12px",padding:"1.5rem"},children:[(0,i.jsx)("h3",{style:{marginTop:0,marginBottom:"1rem"},children:"Budget Usage"}),b?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{style:{display:"flex",gap:"2rem",flexWrap:"wrap"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{style:{margin:0,color:"#666"},children:"Daily Spend"}),(0,i.jsx)("p",{style:{margin:0,fontSize:"1.25rem",fontWeight:600},children:K(b.status.daily_spend)}),(0,i.jsxs)("p",{style:{margin:0,color:b.status.daily_warning?"#d97706":"#666"},children:["Remaining: ",K(b.status.daily_remaining)]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{style:{margin:0,color:"#666"},children:"Monthly Spend"}),(0,i.jsx)("p",{style:{margin:0,fontSize:"1.25rem",fontWeight:600},children:K(b.status.monthly_spend)}),(0,i.jsxs)("p",{style:{margin:0,color:b.status.monthly_warning?"#d97706":"#666"},children:["Remaining: ",K(b.status.monthly_remaining)]})]})]}),(0,i.jsxs)("div",{style:{marginTop:"1rem"},children:[(0,i.jsx)("p",{style:{marginBottom:"0.5rem",color:"#666"},children:"Spend by Model (Monthly)"}),(0,i.jsxs)("ul",{style:{listStyle:"none",padding:0,margin:0},children:[Object.entries(b.usage.by_model).map(e=>{let[t,r]=e;return(0,i.jsxs)("li",{style:{display:"flex",justifyContent:"space-between",padding:"0.25rem 0"},children:[(0,i.jsx)("span",{children:t}),(0,i.jsx)("span",{style:{fontWeight:500},children:K(r)})]},t)}),0===Object.keys(b.usage.by_model).length&&(0,i.jsx)("li",{style:{color:"#666"},children:"No spend recorded yet."})]})]})]}):(0,i.jsx)("p",{style:{color:"#666"},children:"Budget data unavailable."})]}),(0,i.jsxs)("div",{style:{border:"1px solid #eee",borderRadius:"12px",padding:"1.5rem"},children:[(0,i.jsx)("h3",{style:{marginTop:0,marginBottom:"1rem"},children:"Error Trends (Last 7 Days)"}),S?(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:S.days.map(e=>{let t=Object.values(e.errors).reduce((e,t)=>e+t,0),r=Math.min(20*t,240);return(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[(0,i.jsx)("span",{style:{width:"90px",fontSize:"0.8rem",color:"#666"},children:e.date}),(0,i.jsx)("div",{style:{flex:1,backgroundColor:"#f3f4f6",borderRadius:"999px",overflow:"hidden"},children:(0,i.jsx)("div",{style:{width:"".concat(r,"px"),height:"8px",backgroundColor:t>0?"#ef4444":"#a3a3a3"}})}),(0,i.jsx)("span",{style:{minWidth:"24px",textAlign:"right",fontSize:"0.8rem"},children:t})]},e.date)})}):(0,i.jsx)("p",{style:{color:"#666"},children:"No error data available."})]})]})]})]})}},5893:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return a},a:function(){return c},g:function(){return u}});var i=r(6717),n=r(7387);let l=(0,n.createContext)(null);function s(){return localStorage.getItem("mother-harness-token")}function o(){localStorage.removeItem("mother-harness-token")}function d(e){try{var t;let r=e.split(".");if(3!==r.length)return null;let i=JSON.parse(atob(r[1].replace(/-/g,"+").replace(/_/g,"/")));if(i.exp&&i.exp<Date.now()/1e3)return null;return{id:i.sub,email:i.email,name:i.name,roles:null!==(t=i.roles)&&void 0!==t?t:["user"]}}catch(e){return null}}function a(e){let{children:t}=e,[r,a]=(0,n.useState)(null),[c,u]=(0,n.useState)(!0),[h,m]=(0,n.useState)(null);(0,n.useEffect)(()=>{let e=s();if(e){let t=d(e);t?a(t):o()}u(!1)},[]);let p=(0,n.useCallback)(async(e,t)=>{u(!0),m(null);try{var r;let i=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!i.ok){let e=await i.json();return m(null!==(r=e.error)&&void 0!==r?r:"Login failed"),u(!1),!1}let{token:n}=await i.json();localStorage.setItem("mother-harness-token",n);let l=d(n);return a(l),u(!1),!0}catch(e){return m(e instanceof Error?e.message:"Login failed"),u(!1),!1}},[]),x=(0,n.useCallback)(async()=>{o(),a(null);try{await fetch("/api/auth/logout",{method:"POST"})}catch(e){}},[]);return(0,i.jsx)(l.Provider,{value:{user:r,loading:c,error:h,login:p,logout:x,isAuthenticated:!!r},children:t})}function c(){let e=(0,n.useContext)(l);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}function u(){let e=s();return e?{Authorization:"Bearer ".concat(e)}:{}}}},function(e){e.O(0,[407,809,744],function(){return e(e.s=8378)}),_N_E=e.O()}]);