(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{6794:function(e,t,n){Promise.resolve().then(n.bind(n,5893))},5893:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return s},a:function(){return c},g:function(){return h}});var r=n(6717),u=n(7387);let a=(0,u.createContext)(null);function l(){return localStorage.getItem("mother-harness-token")}function o(){localStorage.removeItem("mother-harness-token")}function i(e){try{var t;let n=e.split(".");if(3!==n.length)return null;let r=JSON.parse(atob(n[1].replace(/-/g,"+").replace(/_/g,"/")));if(r.exp&&r.exp<Date.now()/1e3)return null;return{id:r.sub,email:r.email,name:r.name,roles:null!==(t=r.roles)&&void 0!==t?t:["user"]}}catch(e){return null}}function s(e){let{children:t}=e,[n,s]=(0,u.useState)(null),[c,h]=(0,u.useState)(!0),[f,d]=(0,u.useState)(null);(0,u.useEffect)(()=>{let e=l();if(e){let t=i(e);t?s(t):o()}h(!1)},[]);let m=(0,u.useCallback)(async(e,t)=>{h(!0),d(null);try{var n;let r=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!r.ok){let e=await r.json();return d(null!==(n=e.error)&&void 0!==n?n:"Login failed"),h(!1),!1}let{token:u}=await r.json();localStorage.setItem("mother-harness-token",u);let a=i(u);return s(a),h(!1),!0}catch(e){return d(e instanceof Error?e.message:"Login failed"),h(!1),!1}},[]),g=(0,u.useCallback)(async()=>{o(),s(null);try{await fetch("/api/auth/logout",{method:"POST"})}catch(e){}},[]);return(0,r.jsx)(a.Provider,{value:{user:n,loading:c,error:f,login:m,logout:g,isAuthenticated:!!n},children:t})}function c(){let e=(0,u.useContext)(a);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}function h(){let e=l();return e?{Authorization:"Bearer ".concat(e)}:{}}}},function(e){e.O(0,[407,809,744],function(){return e(e.s=6794)}),_N_E=e.O()}]);